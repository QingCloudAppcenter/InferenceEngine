#!/usr/bin/env bash
set -e

cat > /opt/app/bin/.env << DOCKER_COMPOSE_ENV_EOF
MINIO_ACCESS_KEY={{getv "/env/s3.access.key" "AKIAIOSXODNN7EXAMPLE"}}
MINIO_SECRET_KEY={{getv "/env/s3.secret.key" "wJalrXUtqFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"}}
DOCKER_COMPOSE_ENV_EOF

cat > /root/.s3cfg << S3CFG_ENV_EOF
# Setup endpoint
host_base = 127.0.0.1:9000
host_bucket = 127.0.0.1:9000
bucket_location = inference-engine
use_https = False

# Setup access keys
access_key = {{getv "/env/s3.access.key" "AKIAIOSXODNN7EXAMPLE"}}
secret_key = {{getv "/env/s3.secret.key" "wJalrXUtqFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"}}

# Enable S3 v4 signature APIs
signature_v2 = False
S3CFG_ENV_EOF